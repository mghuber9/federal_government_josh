<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit 4 — Hard-Mode Multiple Choice</title>
<style>
  :root{
    --bg:#e5e7eb;
    --panel:#f9fafb;
    --ink:#111827;
    --muted:#6b7280;
    --accent:#2563eb;
    --ok:#16a34a;
    --bad:#dc2626;
    --tile:#ffffff;
    --tile-border:rgba(15,23,42,.12);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    color:var(--ink);
    background:radial-gradient(900px 600px at 15% -10%, #dbeafe 0%, var(--bg) 55%);
  }
  .wrap{max-width:1100px; margin:0 auto; padding:24px}
  h1{margin:0 0 6px; font-size:clamp(22px,3vw,32px)}
  p,label{color:var(--muted)}
  h2{margin:0 0 8px; font-size:18px}
  .card{
    background:var(--panel);
    border:1px solid rgba(15,23,42,.08);
    border-radius:16px;
    padding:18px;
    box-shadow:0 6px 18px rgba(15,23,42,.08);
  }
  .grid{display:grid; gap:12px}
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  @media (max-width:900px){.grid-2{grid-template-columns:1fr}}

  select,button{
    appearance:none;
    border:1px solid rgba(15,23,42,.14);
    background:#eff6ff;
    color:var(--ink);
    padding:10px 12px;
    border-radius:10px;
    font-size:15px;
  }
  button{
    cursor:pointer;
    background:linear-gradient(135deg,#2563eb,#1d4ed8);
    border:1px solid rgba(37,99,235,.7);
    color:#f9fafb;
    font-weight:500;
  }
  button:hover{filter:brightness(1.05)}
  .hidden{display:none}
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
    background:#e5e7eb;
    color:#1f2937;
    font-size:12px;
  }
  .hud{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .sep{height:1px; background:rgba(15,23,42,.08); margin:12px 0}

  .q-card{
    border-radius:14px;
    border:1px solid var(--tile-border);
    background:var(--tile);
    padding:12px 14px;
    margin-bottom:12px;
  }
  .q-header{
    display:flex;
    align-items:flex-start;
    gap:8px;
    margin-bottom:6px;
  }
  .q-num{
    flex:0 0 auto;
    width:28px; height:28px;
    border-radius:999px;
    background:#e5e7eb;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:14px;
    border:1px solid rgba(15,23,42,.12);
  }
  .q-stem{
    flex:1 1 auto;
    font-size:15px;
  }
  .badge{
    margin-left:auto;
    font-size:11px;
    padding:3px 8px;
    border-radius:999px;
    background:#eff6ff;
    border:1px solid rgba(37,99,235,.3);
    color:#1d4ed8;
  }
  .choices{margin:4px 0 0; padding-left:32px}
  .choice{
    display:flex;
    align-items:flex-start;
    gap:6px;
    margin:4px 0;
    padding:4px 6px;
    border-radius:8px;
  }
  .choice.correct{
    background:#dcfce7;
    border:1px solid rgba(22,163,74,.7);
  }
  .choice.wrong{
    background:#fee2e2;
    border:1px solid rgba(220,38,38,.7);
  }
  .choice input{margin-top:3px}
  .choice label{
    flex:1;
    font-size:14px;
    color:var(--ink);
    cursor:pointer;
  }
  .explanation{
    margin-top:6px;
    padding:6px 8px;
    border-radius:8px;
    background:#f3f4f6;
    font-size:13px;
    color:#374151;
  }
  .explanation strong{color:#111827}
  .q-card.correct{
    border-color:rgba(22,163,74,.8);
    box-shadow:0 0 0 1px rgba(22,163,74,.4);
  }
  .q-card.incorrect{
    border-color:rgba(220,38,38,.8);
    box-shadow:0 0 0 1px rgba(220,38,38,.4);
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit 4 — Hard-Mode Multiple Choice</h1>
    <p class="muted">
      These questions are meant to be harder than the regular test:
      more scenarios, compare/contrast, and “best example” style.
      Use this <strong>after</strong> vocab matching, when he can already read the terms comfortably.
    </p>

    <!-- START -->
    <section id="start" class="card grid">
      <div class="grid grid-2">
        <div>
          <label for="section">Question set</label>
          <select id="section">
            <option value="all" selected>All Unit 4 (Ch. 4 + 5 + 14)</option>
            <option value="4">Ch. 4 — Civil Liberties only</option>
            <option value="5">Ch. 5 — Civil Rights only</option>
            <option value="14">Ch. 14 — Judiciary only</option>
          </select>
        </div>
        <div>
          <label for="count">Round size</label>
          <select id="count">
            <option value="10">10 questions</option>
            <option value="15" selected>15 questions</option>
            <option value="20">20 questions</option>
          </select>
        </div>
      </div>
      <div class="hud">
        <button id="begin">Start Hard-Mode Round</button>
        <span class="pill">
          Don’t rush. Think: “What idea is this really testing?” before picking an answer.
        </span>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="card hidden">
      <div class="hud">
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <span class="pill" id="setTag">Set</span>
          <span class="pill" id="progress">Answered 0 / N</span>
        </div>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <span class="pill" id="timer">00:00</span>
          <button id="check">Check Answers</button>
          <button id="newRound">New Round</button>
          <button id="back">Back to Start</button>
        </div>
      </div>
      <div class="sep"></div>
      <div id="questions"></div>
    </section>

    <!-- RESULT (now with full missed-question review) -->
    <section id="result" class="card hidden">
      <h2>Round Summary</h2>
      <div class="hud" style="margin-bottom:6px">
        <span class="pill" id="scoreline">Score</span>
        <span class="pill" id="timeline">Time</span>
      </div>
      <div class="sep"></div>
      <p class="muted" id="coaching"></p>

      <div id="reviewBlock" style="margin-top:12px;"></div>

      <div class="hud" style="margin-top:10px">
        <button id="retry">New Round (same settings)</button>
        <button id="restart">Back to Start</button>
      </div>
    </section>
  </div>

<script>
// ===== Question bank =====
const QUESTIONS = [
  // ===== Chapter 4 — Civil Liberties (original hard set) =====
  {
    id: '4-1',
    chapter: 4,
    stem: 'A state law requires all public schools to begin the day with a short, teacher-led prayer referencing a specific religion. Parents sue, arguing it violates the First Amendment. Which clause is most directly at issue?',
    choices: [
      'Free Exercise Clause, because students are being punished for their religious beliefs.',
      'Establishment Clause, because the government is promoting an official religious exercise.',
      'Free Speech Clause, because students are not allowed to speak during the prayer.',
      'Due Process Clause, because the prayer is not being applied fairly to all students.'
    ],
    correct: 1,
    explanation: 'The government (through public schools) is organizing a religious exercise, which deals with whether the state is endorsing or establishing religion. That is an Establishment Clause question.'
  },
  {
    id: '4-2',
    chapter: 4,
    stem: 'Police receive an anonymous tip that illegal drugs are in someone’s house. Without a warrant, they enter, find drugs, and arrest the homeowner. At trial, the defense attorney argues that the drugs may not be used as evidence. Which doctrine supports that argument?',
    choices: [
      'Substantive due process',
      'The exclusionary rule',
      'The clear and present danger test',
      'The good-faith exception'
    ],
    correct: 1,
    explanation: 'The exclusionary rule keeps evidence obtained in violation of the Fourth Amendment (such as warrantless entry without a valid exception) out of court.'
  },
  {
    id: '4-3',
    chapter: 4,
    stem: 'A city passes a law banning political protests in all public parks because some past protests have become heated. Which test or standard is most relevant for deciding if this restriction on speech is constitutional?',
    choices: [
      'Lemon test',
      'Clear and present danger test',
      'Substantive due process',
      'Miranda rule'
    ],
    correct: 1,
    explanation: 'The clear and present danger test (and later standards) evaluate whether speech can be restricted due to serious, immediate threats to public safety. A total ban in all parks would likely go too far.'
  },
  {
    id: '4-4',
    chapter: 4,
    stem: 'A tabloid knowingly publishes a fake story claiming a mayor takes bribes. The mayor sues. Which combination best describes what the mayor must usually prove to win?',
    choices: [
      'The story was offensive and the mayor is a private figure.',
      'The story was false and the tabloid acted with actual malice.',
      'The story was unpopular and the mayor suffered emotional distress.',
      'The story was anonymous and the mayor requested a retraction.'
    ],
    correct: 1,
    explanation: 'Public officials bringing defamation cases generally must show that the statement was false and published with actual malice—knowledge of falsity or reckless disregard for the truth.'
  },
  {
    id: '4-5',
    chapter: 4,
    stem: 'Which scenario BEST illustrates selective incorporation?',
    choices: [
      'A state passes its own bill of rights to protect citizens.',
      'The Supreme Court applies a part of the Bill of Rights to state governments through the Fourteenth Amendment.',
      'Congress adds a new amendment directly limiting the actions of states.',
      'A city voluntarily expands free speech protection beyond what the Constitution requires.'
    ],
    correct: 1,
    explanation: 'Selective incorporation is when the Supreme Court uses the Fourteenth Amendment to apply specific protections in the Bill of Rights to the states.'
  },
  {
    id: '4-6',
    chapter: 4,
    stem: 'During questioning, police do not inform a suspect of the right to remain silent or to have an attorney. The suspect confesses, and the prosecution uses the confession at trial. Which right is most directly involved?',
    choices: [
      'Right to privacy under substantive due process',
      'Equal protection of the laws',
      'Protection against cruel and unusual punishment',
      'Protection against self-incrimination and the right to counsel (Miranda rights)'
    ],
    correct: 3,
    explanation: 'Miranda rights protect suspects from self-incrimination and ensure access to counsel during custodial interrogation.'
  },
  {
    id: '4-7',
    chapter: 4,
    stem: 'Which of the following most clearly involves the right to privacy recognized by the Supreme Court?',
    choices: [
      'A city bans all political flyers on light poles.',
      'A state restricts access to contraception for married couples.',
      'A school requires students to stand for the national anthem.',
      'A city requires permits for large public parades.'
    ],
    correct: 1,
    explanation: 'Cases involving contraception and certain intimate decisions are examples where the Court has recognized an implied right to privacy.'
  },

  // ===== Chapter 5 — Civil Rights (original hard set) =====
  {
    id: '5-1',
    chapter: 5,
    stem: 'A state creates a law that allows only citizens with grandparents born in the state to vote in primary elections. Minority groups challenge the law in court. Which constitutional principle is most directly at issue?',
    choices: [
      'Substantive due process',
      'Equal Protection Clause',
      'Establishment Clause',
      'Free Exercise Clause'
    ],
    correct: 1,
    explanation: 'The Equal Protection Clause is implicated when a law treats different groups of people differently, especially in something as fundamental as voting.'
  },
  {
    id: '5-2',
    chapter: 5,
    stem: 'Which situation BEST illustrates de facto segregation rather than de jure segregation?',
    choices: [
      'A state law requires separate schools for white and Black students.',
      'A city ordinance bans minorities from living in certain neighborhoods.',
      'Neighborhood housing patterns and income differences lead to mostly one-race schools, even without segregation laws.',
      'A state constitution explicitly states that different races must use different public facilities.'
    ],
    correct: 2,
    explanation: 'De facto segregation occurs because of social or economic conditions, such as housing patterns, not because the law requires it.'
  },
  {
    id: '5-3',
    chapter: 5,
    stem: 'Which development weakened the “separate but equal” doctrine from Plessy v. Ferguson?',
    choices: [
      'The Supreme Court upholding literacy tests for voting.',
      'Brown v. Board of Education ruling that segregated schools are inherently unequal.',
      'The adoption of poll taxes in Southern states.',
      'The Supreme Court limiting affirmative action programs.'
    ],
    correct: 1,
    explanation: 'Brown v. Board of Education declared that separate educational facilities are inherently unequal, directly rejecting “separate but equal” in public education.'
  },
  {
    id: '5-4',
    chapter: 5,
    stem: 'A state university gives a small admissions plus-factor to applicants from racial groups that have been historically excluded, while still considering grades, test scores, and activities. Which policy is this?',
    choices: [
      'De jure segregation',
      'Affirmative action',
      'Substantive due process',
      'Judicial review'
    ],
    correct: 1,
    explanation: 'Affirmative action policies intentionally take race (or other characteristics) into account, usually as one factor among many, to address past discrimination.'
  },
  {
    id: '5-5',
    chapter: 5,
    stem: 'A law treats men and women differently. Which judicial standard is MOST likely used to evaluate whether the law violates equal protection?',
    choices: [
      'Strict scrutiny',
      'Intermediate scrutiny',
      'Rational basis test',
      'Political question doctrine'
    ],
    correct: 1,
    explanation: 'Gender classifications generally receive intermediate scrutiny: the law must be substantially related to an important government interest.'
  },
  {
    id: '5-6',
    chapter: 5,
    stem: 'Which example BEST matches the purpose of the Voting Rights Act of 1965?',
    choices: [
      'Eliminating poll taxes and literacy tests that blocked minority voters.',
      'Granting women the nationwide right to vote.',
      'Setting the voting age at 18 for all elections.',
      'Requiring all citizens to register to vote by age 21.'
    ],
    correct: 0,
    explanation: 'The Voting Rights Act of 1965 targeted practices like literacy tests and other devices used to suppress minority voting.'
  },
  {
    id: '5-7',
    chapter: 5,
    stem: 'A company refuses to install a wheelchair ramp at its only entrance, even though many customers use wheelchairs. Which federal law is most clearly related to this situation?',
    choices: [
      'Civil Rights Act of 1964',
      'Americans with Disabilities Act (ADA)',
      'Title IX',
      'Equal Rights Amendment'
    ],
    correct: 1,
    explanation: 'The ADA requires reasonable accommodations and prohibits discrimination against people with disabilities in public accommodations and employment.'
  },
  {
    id: '5-8',
    chapter: 5,
    stem: 'A public school consistently offers far fewer athletic opportunities to girls than to boys, despite similar interest. Which law is most relevant for a legal challenge?',
    choices: [
      'Title IX',
      'Voting Rights Act of 1965',
      'Thirteenth Amendment',
      'Nineteenth Amendment'
    ],
    correct: 0,
    explanation: 'Title IX bans sex discrimination in education programs that receive federal funds, including athletics.'
  },

  // ===== Chapter 14 — Judiciary (original hard set) =====
  {
    id: '14-1',
    chapter: 14,
    stem: 'Congress passes a law that seems to clearly conflict with the First Amendment. A lawsuit challenges the law, and the Supreme Court strikes it down. Which power did the Court use?',
    choices: [
      'Judicial review',
      'Original jurisdiction',
      'Judicial restraint',
      'Federal supremacy'
    ],
    correct: 0,
    explanation: 'Judicial review is the power of courts to declare laws or executive actions unconstitutional.'
  },
  {
    id: '14-2',
    chapter: 14,
    stem: 'A case begins in a federal trial court, then is appealed to a higher federal court that reviews for legal errors but does not conduct a new trial. What kind of court is the higher court?',
    choices: [
      'Court exercising original jurisdiction',
      'Court exercising appellate jurisdiction',
      'State supreme court',
      'Magistrate court'
    ],
    correct: 1,
    explanation: 'A court with appellate jurisdiction reviews decisions of lower courts rather than hearing cases first.'
  },
  {
    id: '14-3',
    chapter: 14,
    stem: 'Four Supreme Court justices believe an issue is important enough to be heard, even though five justices do not. Under Court practice, what happens next?',
    choices: [
      'The Court must deny the case because a majority is required.',
      'The case is heard because of the “rule of four.”',
      'The case is automatically sent to Congress instead.',
      'The case is remanded to the lower court without explanation.'
    ],
    correct: 1,
    explanation: 'Under the informal “rule of four,” if at least four justices vote to grant certiorari, the Court agrees to hear the case.'
  },
  {
    id: '14-4',
    chapter: 14,
    stem: 'Which situation BEST illustrates judicial restraint rather than judicial activism?',
    choices: [
      'The Court frequently overturns state laws to expand individual rights.',
      'The Court refuses to strike down a controversial law, saying elected officials should decide unless the law clearly violates the Constitution.',
      'The Court reads broad new rights into the Constitution not mentioned in the text.',
      'The Court strikes down long-standing precedents to pursue a new interpretation.'
    ],
    correct: 1,
    explanation: 'Judicial restraint emphasizes deferring to elected branches and existing precedent unless a law clearly conflicts with the Constitution.'
  },
  {
    id: '14-5',
    chapter: 14,
    stem: 'In a Supreme Court case, five justices agree on the outcome and reasoning. Two other justices agree with the outcome but write separately to explain a different reason. Which term describes the separate opinion?',
    choices: [
      'Majority opinion',
      'Concurring opinion',
      'Dissenting opinion',
      'Per curiam opinion'
    ],
    correct: 1,
    explanation: 'A concurring opinion agrees with the result but offers different or additional reasoning.'
  },
  {
    id: '14-6',
    chapter: 14,
    stem: 'Which scenario BEST illustrates the idea of stare decisis?',
    choices: [
      'The Court rejects all past cases in order to start fresh.',
      'The Court follows a previous decision in a similar case unless there is a strong reason to change it.',
      'The Court automatically adopts whatever Congress says.',
      'The Court refuses to hear any controversial cases.'
    ],
    correct: 1,
    explanation: 'Stare decisis means “let the decision stand” and refers to following precedent when deciding new cases.'
  },
  {
    id: '14-7',
    chapter: 14,
    stem: 'A party who lost in a federal district court believes the trial judge made legal errors. To which court will they most likely appeal?',
    choices: [
      'U.S. Supreme Court',
      'U.S. Court of Appeals (Circuit court)',
      'State Supreme Court',
      'Local magistrate court'
    ],
    correct: 1,
    explanation: 'Most appeals from U.S. district courts go to the U.S. Courts of Appeals.'
  },
  {
    id: '14-8',
    chapter: 14,
    stem: 'Which situation BEST describes a justiciable controversy?',
    choices: [
      'Two friends debating politics at lunch.',
      'A lawsuit where a business sues a city over an ordinance that has already harmed its profits.',
      'A senator asking the Court for advice on how to vote on a bill.',
      'A hypothetical question about a law that might be passed someday.'
    ],
    correct: 1,
    explanation: 'A justiciable controversy is a real, concrete dispute appropriate for court resolution, not a hypothetical or political question.'
  },

  // ===== EXTRA HARD QUESTIONS — CIVIL LIBERTIES (Ch. 4) =====
  {
    id: '4-8',
    chapter: 4,
    stem: 'A state argues that the Bill of Rights does not limit what state police can do, only what federal agents can do. In response, a lawyer cites Gitlow v. New York and the Fourteenth Amendment. What idea is the lawyer using?',
    choices: [
      'Dual federalism',
      'Selective incorporation of fundamental rights against the states',
      'Judicial restraint',
      'The political question doctrine'
    ],
    correct: 1,
    explanation: 'Gitlow v. New York is one of the first cases where the Court said parts of the Bill of Rights (like free speech) apply to the states through the Fourteenth Amendment—this is selective incorporation.'
  },
  {
    id: '4-9',
    chapter: 4,
    stem: 'A public school district allows student religious clubs to meet after school but refuses to let a Bible club use empty classrooms, even though other clubs can. The Bible club sues. Which is the strongest argument for the club?',
    choices: [
      'The school is violating the Free Exercise Clause by singling out religious expression for worse treatment.',
      'The school is required to promote religion under the Establishment Clause.',
      'The school is required to fund religious activities directly.',
      'The school must eliminate all clubs to comply with separation of church and state.'
    ],
    correct: 0,
    explanation: 'When a public school creates an open forum for clubs but excludes a religious club, it is treating religious speech worse than other speech, raising a Free Exercise and free-speech problem.'
  },
  {
    id: '4-10',
    chapter: 4,
    stem: 'A state requires that a large Ten Commandments monument be placed alone in front of every courthouse with no other historical displays. A challenger argues it violates the Establishment Clause under the Lemon test. Which part of Lemon is the challenger MOST likely to focus on?',
    choices: [
      'The law’s primary effect is to advance a particular religion, not to educate about history.',
      'The law has no effect on religion at all.',
      'The law does not involve any government action.',
      'The law clearly avoids any entanglement with religion.'
    ],
    correct: 0,
    explanation: 'A stand-alone religious monument at the courthouse looks like government endorsement of one religion, failing the “primary effect” prong of the Lemon test.'
  },
  {
    id: '4-11',
    chapter: 4,
    stem: 'A protester burns a U.S. flag on the steps of the state capitol to criticize government policy. He is arrested under a state law banning flag desecration. Which precedent is most helpful to his case?',
    choices: [
      'Texas v. Johnson, protecting flag burning as symbolic speech',
      'Mapp v. Ohio, applying the exclusionary rule to the states',
      'Miranda v. Arizona, protecting rights during interrogation',
      'Roe v. Wade, protecting privacy in abortion decisions'
    ],
    correct: 0,
    explanation: 'Texas v. Johnson held that flag burning in political protest is protected symbolic speech under the First Amendment.'
  },
  {
    id: '4-12',
    chapter: 4,
    stem: 'A state passes a law saying “It is illegal to publish any criticism of the governor during a public health emergency.” Which First Amendment principle is most clearly violated?',
    choices: [
      'Prior restraint and protections for political speech',
      'The right to petition the government',
      'Free exercise of religion',
      'The Takings Clause'
    ],
    correct: 0,
    explanation: 'Banning criticism of officials, especially by stopping publication beforehand, is classic prior restraint and directly conflicts with strong protection for political speech.'
  },
  {
    id: '4-13',
    chapter: 4,
    stem: 'Police get a warrant that mistakenly lists the wrong apartment number, but they reasonably believe they are at the correct address and find evidence of a crime. The defense argues for exclusion. Which concept gives prosecutors the best response?',
    choices: [
      'The good-faith exception to the exclusionary rule',
      'The clear and present danger test',
      'The political question doctrine',
      'De facto segregation'
    ],
    correct: 0,
    explanation: 'Under the good-faith exception, evidence may be admitted if police reasonably relied on a warrant that turned out to be defective.'
  },
  {
    id: '4-14',
    chapter: 4,
    stem: 'A state bans the sale of contraception even to married couples. A couple challenges the law, pointing to Griswold v. Connecticut. What constitutional idea did Griswold rely on?',
    choices: [
      'An implied right to privacy created by “penumbras” of several amendments',
      'The explicit text of the Tenth Amendment',
      'The Commerce Clause',
      'The Guarantee Clause'
    ],
    correct: 0,
    explanation: 'Griswold recognized a right to privacy in marital decisions based on “penumbras” and “emanations” from various Bill of Rights provisions.'
  },
  {
    id: '4-15',
    chapter: 4,
    stem: 'A state passes a law requiring women seeking abortions to receive extensive counseling, undergo multiple invasive tests, and travel to one clinic in the state that is only open one day per month. Under modern abortion jurisprudence, what is the key standard used to evaluate whether these rules are constitutional?',
    choices: [
      'Whether the law places an “undue burden” on the exercise of the right',
      'Whether the law satisfies the Lemon test',
      'Whether the law passes the clear and present danger test',
      'Whether the law supports separate but equal facilities'
    ],
    correct: 0,
    explanation: 'After Roe, cases like Planned Parenthood v. Casey used the “undue burden” standard to judge whether abortion regulations are too restrictive.'
  },
  {
    id: '4-16',
    chapter: 4,
    stem: 'Police stop a car for a broken taillight and then search the entire trunk without consent or probable cause. They find stolen goods. Which amendment is most directly involved when deciding whether the search was lawful?',
    choices: [
      'Fourth Amendment protection against unreasonable searches and seizures',
      'Fifth Amendment protection against self-incrimination',
      'Sixth Amendment right to counsel',
      'Eighth Amendment protection from cruel and unusual punishment'
    ],
    correct: 0,
    explanation: 'Whether the trunk search is lawful depends on Fourth Amendment rules about probable cause and the scope of a traffic-stop search.'
  },
  {
    id: '4-17',
    chapter: 4,
    stem: 'A defendant is sentenced to death after a trial where the jury is given no guidance about when to impose the death penalty, leading to arbitrary results. Which case provides the strongest precedent to challenge this system?',
    choices: [
      'Furman v. Georgia, which struck down arbitrary death penalty schemes',
      'Gregg v. Georgia, which banned the death penalty forever',
      'Schenck v. United States, which limited speech',
      'Gitlow v. New York, which began incorporation'
    ],
    correct: 0,
    explanation: 'Furman v. Georgia halted the death penalty because it was being imposed in an arbitrary and capricious manner.'
  },
  {
    id: '4-18',
    chapter: 4,
    stem: 'A journalist is arrested for publishing leaked documents that embarrass the government but reveal no military secrets or ongoing operations. The government claims “national security” and demands punishment. Historically, how has the Court treated such attempts to punish critical press?',
    choices: [
      'The Court has usually protected the press unless the speech creates a serious, immediate threat to national security.',
      'The Court always sides with the president in national security cases.',
      'The Court bans all publication of leaked information.',
      'The Court treats criticism of the government as fighting words.'
    ],
    correct: 0,
    explanation: 'Cases like the Pentagon Papers show a strong presumption against punishing press criticism absent a clear, immediate danger.'
  },
  {
    id: '4-19',
    chapter: 4,
    stem: 'A student silently kneels during the national anthem at a football game to protest racial injustice. The school wants to punish the student for being “disrespectful.” Which earlier student-speech case gives the student the strongest support?',
    choices: [
      'Tinker v. Des Moines, protecting symbolic student protest',
      'Miller v. California, defining obscenity',
      'Engel v. Vitale, banning school-sponsored prayer',
      'Gideon v. Wainwright, providing counsel for indigent defendants'
    ],
    correct: 0,
    explanation: 'Tinker held that students do not “shed their constitutional rights at the schoolhouse gate” and protected silent, non-disruptive protest.'
  },
  {
    id: '4-20',
    chapter: 4,
    stem: 'A suspect asks clearly for a lawyer during police questioning, but officers continue to interrogate and get a confession. Which combination of rights is most clearly violated?',
    choices: [
      'The Fifth Amendment right against self-incrimination and the Sixth Amendment right to counsel',
      'The Establishment and Free Exercise Clauses',
      'The Third Amendment ban on quartering soldiers',
      'The Tenth Amendment reserved powers'
    ],
    correct: 0,
    explanation: 'Miranda and related cases protect the right to remain silent and to have counsel present; questioning should stop once the suspect asks for a lawyer.'
  },

  // ===== EXTRA HARD QUESTIONS — CIVIL RIGHTS (Ch. 5) =====
  {
    id: '5-9',
    chapter: 5,
    stem: 'A city redraws its school attendance zones so that, on paper, they are race-neutral. However, the lines are drawn in a way that keeps nearly all schools one-race because of known housing patterns. Which type of segregation is this MOST likely to be?',
    choices: [
      'De jure segregation enforced directly by law',
      'De facto segregation resulting from housing and policy choices',
      'Segregation required by the Voting Rights Act',
      'Segregation protected by the Fifteenth Amendment'
    ],
    correct: 1,
    explanation: 'When segregation results from housing patterns and seemingly neutral policies, it is usually described as de facto segregation.'
  },
  {
    id: '5-10',
    chapter: 5,
    stem: 'A hotel near an interstate highway refuses to rent rooms to Black travelers. Congress passes a law banning discrimination in public accommodations based on its power to regulate interstate commerce. Which case upheld this sort of law?',
    choices: [
      'Heart of Atlanta Motel v. United States',
      'Plessy v. Ferguson',
      'Dred Scott v. Sandford',
      'Engel v. Vitale'
    ],
    correct: 0,
    explanation: 'Heart of Atlanta Motel v. United States upheld the Civil Rights Act of 1964’s public accommodations provisions using the Commerce Clause.'
  },
  {
    id: '5-11',
    chapter: 5,
    stem: 'A state university uses a rigid quota system: exactly 20% of spots are reserved for applicants of a certain race, regardless of other qualifications. An applicant rejected because of the quota sues. Which precedent is most directly on point?',
    choices: [
      'Regents of the University of California v. Bakke, which disallowed rigid racial quotas',
      'Brown v. Board of Education, which ended school segregation',
      'Loving v. Virginia, which invalidated interracial marriage bans',
      'Shelby County v. Holder, which limited the Voting Rights Act'
    ],
    correct: 0,
    explanation: 'Bakke struck down strict quotas but allowed race to be one factor in a holistic admissions process.'
  },
  {
    id: '5-12',
    chapter: 5,
    stem: 'A state law says only men can inherit property in certain situations. The law is challenged under the Equal Protection Clause. What level of scrutiny is most likely applied to this gender-based classification?',
    choices: [
      'Intermediate scrutiny—substantially related to an important government interest',
      'Strict scrutiny—necessary to achieve a compelling interest',
      'Rational basis—any legitimate interest',
      'No judicial review at all'
    ],
    correct: 0,
    explanation: 'Gender classifications are generally reviewed under intermediate scrutiny, which is tougher than rational basis but not as strict as strict scrutiny.'
  },
  {
    id: '5-13',
    chapter: 5,
    stem: 'A state requires voters to pass a complex test about constitutional trivia, but local officials only enforce it against minority voters. Which combination of constitutional provisions and laws gives the strongest challenge?',
    choices: [
      'Fifteenth Amendment plus the Voting Rights Act of 1965',
      'Tenth Amendment plus the Twenty-Second Amendment',
      'Third Amendment plus the Commerce Clause',
      'Establishment Clause plus the Free Exercise Clause'
    ],
    correct: 0,
    explanation: 'The Fifteenth Amendment bars racial discrimination in voting, and the Voting Rights Act was designed specifically to eliminate practices like literacy tests that target minorities.'
  },
  {
    id: '5-14',
    chapter: 5,
    stem: 'A landlord uses “whites only” language in all written leases and refuses to rent to minority tenants. Which best describes this behavior?',
    choices: [
      'A clear violation of modern civil rights and fair housing laws',
      'An example of de facto segregation only',
      'A political question protected from court review',
      'A form of symbolic speech fully protected by the First Amendment'
    ],
    correct: 0,
    explanation: 'Modern civil rights and fair housing laws prohibit explicit racial discrimination in renting and housing.'
  },
  {
    id: '5-15',
    chapter: 5,
    stem: 'A transgender student is denied access to any restroom facilities that match their gender identity, even though other students are freely allowed to use facilities that fit their identity. A lawsuit is filed under federal civil rights laws. Which trend in civil rights policy does this BEST reflect?',
    choices: [
      'The extension of equality claims to new groups over time',
      'The elimination of all equal protection claims in federal court',
      'The dominance of de jure segregation',
      'The end of strict scrutiny for race cases'
    ],
    correct: 0,
    explanation: 'Recent civil rights developments have involved extending equality arguments to LGBTQ+ individuals, including in schools.'
  },
  {
    id: '5-16',
    chapter: 5,
    stem: 'After Brown v. Board of Education, some states responded slowly or not at all to desegregation orders. Which branch of the federal government most directly enforced school desegregation in some of these conflicts?',
    choices: [
      'The executive branch, sometimes sending federal troops or marshals to enforce court orders',
      'The Federal Reserve, through interest rates',
      'The House of Representatives, through impeachment',
      'The United Nations, through peacekeepers'
    ],
    correct: 0,
    explanation: 'Presidents sometimes had to use executive power, including sending troops or federal marshals, to enforce the Court’s desegregation decisions.'
  },
  {
    id: '5-17',
    chapter: 5,
    stem: 'A state constitution is amended to say that no city or county in the state may pass any law protecting gay or lesbian people from discrimination, even though other groups can be protected. Which case is most similar?',
    choices: [
      'Romer v. Evans, which struck down a similar Colorado amendment',
      'Brown v. Board of Education',
      'Plessy v. Ferguson',
      'Schenck v. United States'
    ],
    correct: 0,
    explanation: 'Romer v. Evans invalidated a state amendment that singled out LGBTQ+ people by forbidding any local protections for them.'
  },
  {
    id: '5-18',
    chapter: 5,
    stem: 'A law classifies people based on race. Under modern equal protection analysis, what standard of review will the Court typically apply?',
    choices: [
      'Strict scrutiny, requiring a compelling government interest and narrow tailoring',
      'Intermediate scrutiny, requiring an important interest',
      'Rational basis, requiring only a legitimate interest',
      'No scrutiny, because race classifications are always allowed'
    ],
    correct: 0,
    explanation: 'Race-based classifications are suspect and receive strict scrutiny under equal protection analysis.'
  },
  {
    id: '5-19',
    chapter: 5,
    stem: 'Employees in a company experience repeated unwanted sexual comments and touching from a supervisor. The behavior is severe and pervasive, and the company does nothing. Under civil rights law, how is this most likely categorized?',
    choices: [
      'Sexual harassment creating a hostile work environment',
      'A political question',
      'De facto segregation',
      'A form of symbolic speech'
    ],
    correct: 0,
    explanation: 'Hostile work environment sexual harassment is treated as a form of sex discrimination under civil rights law.'
  },
  {
    id: '5-20',
    chapter: 5,
    stem: 'A school district claims that it has completely eliminated racial barriers because there are no segregation laws on the books, even though neighborhoods and schools remain sharply divided by race and income. Which insight from civil rights policy BEST challenges the district’s claim?',
    choices: [
      'Ending de jure segregation does not automatically end de facto segregation or inequality.',
      'Civil rights only apply to federal laws.',
      'Judicial review does not apply to education.',
      'Equal protection applies only in criminal trials.'
    ],
    correct: 0,
    explanation: 'The history of civil rights shows that ending explicit legal segregation (de jure) doesn’t automatically fix inequality caused by housing, income, and other factors.'
  },

  // ===== EXTRA HARD QUESTIONS — JUDICIARY (Ch. 14) =====
  {
    id: '14-9',
    chapter: 14,
    stem: 'Congress creates a new federal environmental court and gives it the power to hear cases involving federal pollution laws. A lawsuit about a local traffic ticket is filed there and dismissed. What is the best explanation for the dismissal?',
    choices: [
      'The environmental court lacks subject-matter jurisdiction over traffic tickets.',
      'The case is not justiciable because it involves the environment.',
      'The Supreme Court must hear all traffic cases first.',
      'State courts have no jurisdiction over any criminal case.'
    ],
    correct: 0,
    explanation: 'Jurisdiction refers to a court’s authority to hear certain types of cases; an environmental court would not have jurisdiction over an ordinary traffic ticket.'
  },
  {
    id: '14-10',
    chapter: 14,
    stem: 'A losing party in a civil case wants a higher court to examine whether the trial judge applied the law correctly, but does not present new witnesses or evidence. Into what kind of court is this party moving the case?',
    choices: [
      'A court with appellate jurisdiction, such as a U.S. Court of Appeals',
      'A court with original jurisdiction, such as a district court',
      'A court of limited jurisdiction, such as a traffic court',
      'A military tribunal'
    ],
    correct: 0,
    explanation: 'Appellate courts review the application of law and procedures from lower courts; they do not hold a new trial with new evidence.'
  },
  {
    id: '14-11',
    chapter: 14,
    stem: 'A federal judge issues a controversial ruling striking down a major federal law. Some members of Congress are furious and want to fire the judge immediately. Under the Constitution, which is the proper way to remove a federal judge?',
    choices: [
      'Impeachment by the House and conviction by the Senate for serious misconduct',
      'A simple majority vote in the Supreme Court',
      'A presidential executive order',
      'A national referendum'
    ],
    correct: 0,
    explanation: 'Federal judges hold office during “good behavior” and can only be removed through impeachment and conviction.'
  },
  {
    id: '14-12',
    chapter: 14,
    stem: 'In a controversial case, the Court declines to decide whether a foreign war is constitutional and says the issue is for Congress and the president. Which idea is the Court applying?',
    choices: [
      'The political question doctrine and judicial restraint',
      'Judicial activism',
      'Stare decisis',
      'Strict scrutiny'
    ],
    correct: 0,
    explanation: 'Some issues are treated as political questions better resolved by the elected branches; declining to decide them is a form of judicial restraint.'
  },
  {
    id: '14-13',
    chapter: 14,
    stem: 'A Supreme Court majority overrules a long-standing precedent because it believes the earlier case was wrongly decided and conflicts with the Constitution’s text. Which tension in judicial decision-making does this illustrate?',
    choices: [
      'The tension between stare decisis (respecting precedent) and correcting constitutional errors',
      'The tension between the House and the Senate',
      'The conflict between the Bill of Rights and the Preamble',
      'The conflict between civil and criminal law'
    ],
    correct: 0,
    explanation: 'Sometimes the Court must choose between following precedent and overturning it to align the law more closely with the Constitution.'
  },
  {
    id: '14-14',
    chapter: 14,
    stem: 'A criminal defendant claims that the police violated the Fourth Amendment by searching his home without a proper warrant. The trial judge agrees the search was unconstitutional but still allows the evidence to be used. On appeal, what doctrine is the defendant MOST likely to rely on?',
    choices: [
      'The exclusionary rule, which bars illegally obtained evidence',
      'The Lemon test',
      'The clear and present danger test',
      'The rule of four'
    ],
    correct: 0,
    explanation: 'The exclusionary rule prohibits the government from using evidence obtained in violation of the Fourth Amendment.'
  },
  {
    id: '14-15',
    chapter: 14,
    stem: 'Two neighboring states disagree about water usage in a shared river. Which court has original jurisdiction over a lawsuit between the states?',
    choices: [
      'The U.S. Supreme Court',
      'A state trial court in either state',
      'A U.S. Court of Appeals',
      'A local magistrate court'
    ],
    correct: 0,
    explanation: 'The Constitution gives the Supreme Court original jurisdiction in cases between states.'
  },
  {
    id: '14-16',
    chapter: 14,
    stem: 'Interest groups that are not directly involved in a case often want to influence the Supreme Court’s decision. Which tool do they commonly use?',
    choices: [
      'Filing amicus curiae (“friend of the court”) briefs',
      'Impeaching the justices',
      'Vetoing the Court’s opinion',
      'Declaring the case nonjusticiable'
    ],
    correct: 0,
    explanation: 'Amicus briefs let nonparties present legal arguments or policy concerns to the Court.'
  },
  {
    id: '14-17',
    chapter: 14,
    stem: 'The president nominates a justice with a very controversial record. Advocacy groups run national TV ads urging the Senate to reject the nominee. What does this episode BEST illustrate about modern judicial politics?',
    choices: [
      'Supreme Court confirmations have become highly visible and politically contested because of the Court’s role in major policy areas.',
      'The Court is no longer independent of Congress.',
      'Judicial review has been abolished.',
      'The Constitution requires direct popular election of justices.'
    ],
    correct: 0,
    explanation: 'Because the Court affects major policies, confirmation battles have become political and high profile.'
  },
  {
    id: '14-18',
    chapter: 14,
    stem: 'A case challenging a federal law goes through a U.S. District Court, then a U.S. Court of Appeals, and finally reaches the Supreme Court. At each level, the judges interpret the same constitutional text. What does this show about the nature of civil liberties policy making?',
    choices: [
      'Civil liberties are shaped over time by multiple levels of courts interpreting the Constitution.',
      'Only the Supreme Court matters for civil liberties.',
      'Congress alone decides civil liberties.',
      'Civil liberties are not affected by court decisions.'
    ],
    correct: 0,
    explanation: 'Civil liberties policy emerges from many decisions made by different courts, not just a single case.'
  },
  {
    id: '14-19',
    chapter: 14,
    stem: 'A plaintiff sues the federal government, claiming a new law violates the First Amendment. The federal trial court rules against the plaintiff, and the plaintiff appeals. After the Court of Appeals rules, the plaintiff wants the Supreme Court to review the case. What must the plaintiff typically ask the Court to issue?',
    choices: [
      'A writ of certiorari',
      'A writ of habeas corpus',
      'A bill of attainder',
      'A line-item veto'
    ],
    correct: 0,
    explanation: 'Most cases reach the Supreme Court by writ of certiorari, where the Court agrees to review the lower court’s decision.'
  },
  {
    id: '14-20',
    chapter: 14,
    stem: 'A majority of justices agree that a law is unconstitutional and strike it down. One justice writes separately to say the law is constitutional but should still be struck down for a different technical reason. What is that separate opinion called?',
    choices: [
      'A concurring opinion, because it agrees with the result but uses different reasoning',
      'A dissenting opinion, because it disagrees',
      'A per curiam opinion, because it is unsigned',
      'A plurality opinion, because it has no majority'
    ],
    correct: 0,
    explanation: 'A concurring opinion agrees with the outcome but offers different or additional reasoning.'
  }
];

// ===== Helpers =====
function shuffle(arr){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function fmtTime(s){
  const m = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  return `${m}:${ss}`;
}
function chapterLabel(ch){
  if(ch === 4) return 'Ch. 4 — Civil Liberties';
  if(ch === 5) return 'Ch. 5 — Civil Rights';
  if(ch === 14) return 'Ch. 14 — Judiciary';
  return 'Unit 4 Mixed';
}

// ===== State =====
let state = {
  roundQuestions: [],
  timer: null,
  seconds: 0,
  setKey: 'all'
};

function startTimer(){
  if(state.timer) clearInterval(state.timer);
  state.seconds = 0;
  document.getElementById('timer').textContent = '00:00';
  state.timer = setInterval(()=>{
    state.seconds++;
    document.getElementById('timer').textContent = fmtTime(state.seconds);
  },1000);
}
function stopTimer(){
  if(state.timer){
    clearInterval(state.timer);
    state.timer = null;
  }
}

// ===== Build round =====
function buildRound(){
  const section = document.getElementById('section').value;
  const count = Number(document.getElementById('count').value);
  state.setKey = section;

  let pool;
  if(section === 'all'){
    pool = [...QUESTIONS];
  } else {
    const ch = Number(section);
    pool = QUESTIONS.filter(q => q.chapter === ch);
  }
  pool = shuffle(pool);
  const selected = pool.slice(0, Math.min(count, pool.length));
  state.roundQuestions = selected;

  document.getElementById('start').classList.add('hidden');
  document.getElementById('result').classList.add('hidden');
  document.getElementById('quiz').classList.remove('hidden');

  const label = section === 'all' ? 'All Unit 4 (hard mode)' : chapterLabel(Number(section));
  document.getElementById('setTag').textContent = label;

  renderQuestions();
  updateProgress();
  startTimer();
}

function renderQuestions(){
  const container = document.getElementById('questions');
  container.innerHTML = '';
  state.roundQuestions.forEach((q, idx)=>{
    const card = document.createElement('div');
    card.className = 'q-card';
    card.dataset.qid = q.id;

    const header = document.createElement('div');
    header.className = 'q-header';

    const num = document.createElement('div');
    num.className = 'q-num';
    num.textContent = idx + 1;

    const stem = document.createElement('div');
    stem.className = 'q-stem';
    stem.textContent = q.stem;

    const badge = document.createElement('div');
    badge.className = 'badge';
    badge.textContent = chapterLabel(q.chapter);

    header.appendChild(num);
    header.appendChild(stem);
    header.appendChild(badge);

    const choicesDiv = document.createElement('div');
    choicesDiv.className = 'choices';

    q.choices.forEach((choiceText, cIdx)=>{
      const choice = document.createElement('div');
      choice.className = 'choice';

      const input = document.createElement('input');
      input.type = 'radio';
      input.name = `q_${idx}`;
      input.id = `q_${idx}_${cIdx}`;
      input.value = cIdx;

      input.addEventListener('change', updateProgress);

      const label = document.createElement('label');
      label.setAttribute('for', input.id);
      label.textContent = choiceText;

      choice.appendChild(input);
      choice.appendChild(label);
      choicesDiv.appendChild(choice);
    });

    const expl = document.createElement('div');
    expl.className = 'explanation hidden';
    expl.id = `expl_${idx}`;
    expl.innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;

    card.appendChild(header);
    card.appendChild(choicesDiv);
    card.appendChild(expl);

    container.appendChild(card);
  });
}

function updateProgress(){
  const total = state.roundQuestions.length;
  let answered = 0;
  state.roundQuestions.forEach((q, idx)=>{
    const inputs = document.querySelectorAll(`input[name="q_${idx}"]`);
    if([...inputs].some(i=>i.checked)) answered++;
  });
  document.getElementById('progress').textContent =
    `Answered ${answered} / ${total}`;
}

// ===== Updated Check Answers with full review =====
function checkAnswers(){
  stopTimer();

  const total = state.roundQuestions.length;
  let correct = 0;

  const reviewBlock = document.getElementById('reviewBlock');
  reviewBlock.innerHTML = ''; // clear previous review

  const missed = [];

  state.roundQuestions.forEach((q, idx)=>{
    const card = document.querySelectorAll('.q-card')[idx];
    const expl = document.getElementById(`expl_${idx}`);
    const inputs = document.querySelectorAll(`input[name="q_${idx}"]`);
    const choices = card.querySelectorAll('.choice');
    let selectedIndex = null;

    inputs.forEach((input, cIdx)=>{
      if(input.checked) selectedIndex = cIdx;
    });

    // reset styles
    card.classList.remove('correct','incorrect');
    choices.forEach(c => c.classList.remove('correct','wrong'));

    if(selectedIndex === q.correct){
      correct++;
      card.classList.add('correct');
      if(selectedIndex !== null){
        choices[selectedIndex].classList.add('correct');
      }
    } else {
      card.classList.add('incorrect');
      if(selectedIndex !== null){
        choices[selectedIndex].classList.add('wrong');
      }
      choices[q.correct].classList.add('correct');

      // store for review panel
      missed.push({
        index: idx,
        q,
        selectedIndex
      });
    }

    expl.classList.remove('hidden');
  });

  // Build review panel for missed questions (full blocks)
  if(missed.length === 0){
    const msg = document.createElement('p');
    msg.className = 'muted';
    msg.textContent = 'No missed questions this round. You can still scroll back up to scan the explanations if you want, but there is nothing to review here.';
    reviewBlock.appendChild(msg);
  } else {
    const header = document.createElement('h3');
    header.textContent = 'Missed Questions Review';
    header.style.margin = '0 0 8px';
    reviewBlock.appendChild(header);

    missed.forEach(m=>{
      const idx = m.index;
      const q = m.q;
      const selectedIndex = m.selectedIndex;

      const reviewCard = document.createElement('div');
      reviewCard.className = 'q-card';
      reviewCard.style.marginBottom = '10px';

      const headerRow = document.createElement('div');
      headerRow.className = 'q-header';

      const num = document.createElement('div');
      num.className = 'q-num';
      num.textContent = idx + 1;

      const stem = document.createElement('div');
      stem.className = 'q-stem';
      stem.textContent = q.stem;

      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.textContent = chapterLabel(q.chapter);

      headerRow.appendChild(num);
      headerRow.appendChild(stem);
      headerRow.appendChild(badge);

      const choicesDiv = document.createElement('div');
      choicesDiv.className = 'choices';

      q.choices.forEach((choiceText, cIdx)=>{
        const row = document.createElement('div');
        row.className = 'choice';

        // Style for correct answer vs wrong vs blank
        if (selectedIndex === null) {
          // Unanswered question: highlight correct in BLUE
          if (cIdx === q.correct) {
            row.style.background = '#dbeafe';
            row.style.border = '1px solid #2563eb';
          }
        } else {
          // Question was answered
          if (cIdx === q.correct) {
            row.classList.add('correct');
          }
          if (cIdx === selectedIndex && selectedIndex !== q.correct) {
            row.classList.add('wrong');
          }
        }

        const bullet = document.createElement('div');
        bullet.style.fontSize = '13px';
        bullet.style.marginTop = '2px';
        bullet.textContent = String.fromCharCode(65 + cIdx) + '.';

        const label = document.createElement('label');
        label.style.cursor = 'default';
        label.textContent = choiceText;

        // tag your answer
        if(selectedIndex !== null && cIdx === selectedIndex){
          const tag = document.createElement('span');
          tag.style.fontSize = '11px';
          tag.style.marginLeft = '6px';
          tag.style.color = '#6b7280';
          tag.textContent = ' (your answer)';
          label.appendChild(tag);
        }

        if(selectedIndex === null && cIdx === q.correct){
          const tag = document.createElement('span');
          tag.style.fontSize = '11px';
          tag.style.marginLeft = '6px';
          tag.style.color = '#1d4ed8';
          tag.textContent = ' (correct — unanswered)';
          label.appendChild(tag);
        }

        if(cIdx === q.correct){
          const tag2 = document.createElement('span');
          tag2.style.fontSize = '11px';
          tag2.style.marginLeft = '6px';
          tag2.style.color = '#065f46';
          tag2.textContent = ' (correct)';
          label.appendChild(tag2);
        }

        row.appendChild(bullet);
        row.appendChild(label);
        choicesDiv.appendChild(row);
      });

      const expl = document.createElement('div');
      expl.className = 'explanation';
      expl.innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;

      reviewCard.appendChild(headerRow);
      reviewCard.appendChild(choicesDiv);
      reviewCard.appendChild(expl);

      reviewBlock.appendChild(reviewCard);
    });
  }

  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('result').classList.remove('hidden');

  const pct = total ? Math.round(correct/total*100) : 0;
  document.getElementById('scoreline').textContent =
    `Score: ${correct} / ${total} (${pct}%)`;
  document.getElementById('timeline').textContent =
    `Time: ${fmtTime(state.seconds)}`;

  const coaching = document.getElementById('coaching');
  if(correct === total){
    coaching.textContent = 'Nice. This is test-plus level. You’re not just ready for the exam — you’re reading like a government major.';
  } else if(correct >= Math.ceil(total*0.7)){
    coaching.textContent = 'Solid work. Review the missed explanations: focus on what each scenario is really pointing to (liberty, right, or court power).';
  } else {
    coaching.textContent = 'Good practice rep. The goal here is not the grade but pattern recognition: which concept matches which kind of scenario? Re-run a smaller set and talk through each answer out loud.';
  }
}

// ===== Nav wiring =====
document.getElementById('begin').addEventListener('click', buildRound);
document.getElementById('newRound').addEventListener('click', ()=>{
  stopTimer();
  buildRound();
});
document.getElementById('back').addEventListener('click', ()=>{
  stopTimer();
  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('start').classList.remove('hidden');
});
document.getElementById('check').addEventListener('click', checkAnswers);
document.getElementById('retry').addEventListener('click', ()=>{
  stopTimer();
  buildRound();
});
document.getElementById('restart').addEventListener('click', ()=>{
  document.getElementById('result').classList.add('hidden');
  document.getElementById('start').classList.remove('hidden');
});
</script>
</body>
</html>
