<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit 2 — MC Lightning (94 Questions)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#101a2c; --ink:#e6edf3; --muted:#9fb0c6; --accent:#4fd1c5;
    --ok:#22c55e; --bad:#ef4444; --tile:#0f2034; --tile-border:rgba(255,255,255,.12);
  }
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; color:var(--ink); background:radial-gradient(1100px 700px at 20% -10%, #13233d 0%, var(--bg) 60%);} 
  .wrap{max-width:980px; margin:0 auto; padding:24px}
  h1{margin:0 0 6px; font-size:clamp(22px,3vw,32px)}
  p,label{color:var(--muted)}
  .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .grid{display:grid; gap:12px}
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  select,button{appearance:none; border:1px solid rgba(255,255,255,.12); background:#0f2034; color:var(--ink); padding:10px 12px; border-radius:12px; font-size:16px}
  button{cursor:pointer; background:linear-gradient(135deg,#1f3a5b,#17314f); border:1px solid rgba(79,209,197,.45)}
  button:hover{filter:brightness(1.08)}
  .hidden{display:none}
  .pill{display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:#10243a; color:#a7c6ff; font-size:12px}
  .hud{display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .qtext{font-size:clamp(18px,2.2vw,22px); font-weight:700; line-height:1.35}
  .choices{display:grid; gap:12px; grid-template-columns:repeat(2,minmax(0,1fr)); margin-top:12px}
  @media (max-width: 820px){ .choices{grid-template-columns:1fr;} }
  .tile{min-height:110px; padding:14px; border-radius:14px; border:1px solid var(--tile-border); background:var(--tile); cursor:pointer; display:flex; align-items:center}
  .tile .inner{font-size:clamp(16px,2.1vw,18px); line-height:1.35}
  .tile.correct{background:#0e2b22; border-color:#1f8a67}
  .tile.wrong{background:#3a0f16; border-color:#ff6b6b}
  .muted{color:var(--muted)}
  .sep{height:1px; background:rgba(255,255,255,.08); margin:12px 0}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Lightning Round — Unit 2 (94 MC Questions)</h1>
    <p class="muted">Auto-advance on answer. Stopwatch runs during the round. End screen shows only missed items with the correct answer.</p>

    <!-- START -->
    <section id="start" class="card grid">
      <div class="grid grid-2">
        <div>
          <label for="section">Section</label>
          <select id="section">
            <option value="ch67">Ch. 6–7 (29)</option>
            <option value="ch89">Ch. 8–9 (34)</option>
            <option value="ch1011">Ch. 10–11 (31)</option>
            <option value="unit2" selected>Unit 2 (random 50)</option>
          </select>
        </div>
        <div>
          <label for="order">Order</label>
          <select id="order">
            <option value="shuf" selected>Shuffle</option>
            <option value="seq">In order</option>
          </select>
        </div>
      </div>
      <div class="hud">
        <button id="begin">Start Round</button>
        <span class="pill" id="hint">Answers are shuffled per question.</span>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="card hidden">
      <div class="hud">
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
          <span class="pill" id="setTag">Set</span>
          <span class="pill" id="progress">Q 1 / N</span>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <span class="pill" id="timer">00:00</span>
          <span class="pill" id="best">Best: —</span>
        </div>
      </div>
      <div class="sep"></div>
      <div id="prompt" class="qtext"></div>
      <div id="choices" class="choices"></div>
    </section>

    <!-- RESULT -->
    <section id="result" class="card hidden">
      <h2 style="margin:0 0 6px">Round Complete</h2>
      <div class="hud" style="margin-bottom:6px">
        <span class="pill" id="scoreline">Score</span>
        <span class="pill" id="timeline">Time</span>
        <span class="pill" id="bestline">Best</span>
      </div>
      <div class="sep"></div>
      <div id="review"></div>
      <div class="hud">
        <button id="retry">New Round</button>
        <button id="retryMissed">Retry Missed Only</button>
        <button id="restart">Back to Start</button>
      </div>
    </section>
  </div>

<script>
// ---------- Helpers ----------
function shuffle(a){ const r=[...a]; for(let i=r.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [r[i],r[j]]=[r[j],r[i]]; } return r; }
function fmtTime(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=(s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }
function setBest(key, seconds){ const prev = Number(localStorage.getItem(key)||Infinity); if(seconds < prev){ localStorage.setItem(key, String(seconds)); } }
function getBest(key){ const v = localStorage.getItem(key); return v? fmtTime(Number(v)) : '—'; }

// ---------- Question Bank ----------
const BANK = [
  // paste all 94 question objects here (as in your current working MC file)
];

const SETS = {
  ch67: BANK.filter(x=>x.set==='ch67'),
  ch89: BANK.filter(x=>x.set==='ch89'),
  ch1011: BANK.filter(x=>x.set==='ch1011'),
  unit2: [...BANK]
};
const SET_LABELS = { ch67:'Ch. 6–7 (29)', ch89:'Ch. 8–9 (34)', ch1011:'Ch. 10–11 (31)', unit2:'Unit 2 (50 random)' };

// ---------- State ----------
let state = { list:[], idx:0, setKey:'unit2', answers:[], misses:[], timer:null, seconds:0, missedOnly:false };
function bestKey(){ return `best_mc_${state.setKey}`; }
function startTimer(){ if(state.timer) clearInterval(state.timer); state.timer = setInterval(()=>{ state.seconds++; document.getElementById('timer').textContent = fmtTime(state.seconds); },1000); }
function stopTimer(){ if(state.timer){ clearInterval(state.timer); state.timer=null; } }

function startRound(){
  const sk = document.getElementById('section').value; state.setKey=sk;
  const ord = document.getElementById('order').value;
  let items = [...SETS[sk]];
  if(sk==='unit2') items = shuffle(items).slice(0,50);
  if(ord==='shuf') items = shuffle(items);
  state.list = items.map(x=>({...x}));
  state.idx = 0; state.misses=[]; state.seconds=0; state.missedOnly=false; startTimer();
  document.getElementById('start').classList.add('hidden');
  document.getElementById('result').classList.add('hidden');
  document.getElementById('quiz').classList.remove('hidden');
  document.getElementById('setTag').textContent = SET_LABELS[state.setKey];
  document.getElementById('best').textContent = 'Best: ' + getBest(bestKey());
  renderQ();
}

function renderQ(){
  const q = state.list[state.idx];
  document.getElementById('progress').textContent = `Q ${state.idx+1} / ${state.list.length}`;
  document.getElementById('prompt').textContent = q.q;
  const correctText = q.choices[q.answer];
  const distractors = shuffle(q.choices.filter((_,i)=>i!==q.answer)).slice(0,3);
  const choices = shuffle([{text:correctText, correct:true}, ...distractors.map(d=>({text:d, correct:false}))]);
  const box = document.getElementById('choices'); box.innerHTML='';
  choices.forEach(c=>{
    const btn = document.createElement('button');
    btn.className='tile';
    const inner = document.createElement('div'); inner.className='inner'; inner.textContent=c.text; btn.appendChild(inner);
    btn.addEventListener('click', ()=> pick(c.correct, btn));
    box.appendChild(btn);
  });
}

function pick(isCorrect, node){
  node.classList.add(isCorrect? 'correct' : 'wrong');
  if(!isCorrect){ state.misses.push(state.list[state.idx]); }
  setTimeout(()=>{
    if(state.idx < state.list.length-1){ state.idx++; renderQ(); }
    else { finish(); }
  }, 550);
}

function finish(){
  stopTimer();
  const total = state.list.length; const missed = state.misses.length; const correct = total - missed;
  if(!state.missedOnly){ setBest(bestKey(), state.seconds); }
  document.getElementById('quiz').classList.add('hidden');
  document.getElementById('result').classList.remove('hidden');
  document.getElementById('scoreline').textContent = `Score: ${correct} / ${total} (${Math.round(correct/total*100)}%)`;
  document.getElementById('timeline').textContent = `Time: ${fmtTime(state.seconds)}`;
  document.getElementById('bestline').textContent = `Best: ${getBest(bestKey())}`;
  const rev = document.getElementById('review'); rev.innerHTML='';
  if(missed===0){
    rev.innerHTML = '<p class=\"muted\">Perfect! No missed items to review.</p>';
  } else {
    state.misses.forEach((m,i)=>{
      const correctText = m.choices[m.answer];
      rev.innerHTML += `<div>Missed ${i+1} · Ch. ${m.chapter} — Correct: ${correctText}</div>`;
    });
  }
}

function startRoundMissed(){
  if(!state.misses || state.misses.length===0){ alert('No missed items to retry.'); return; }
  const items = state.misses.map(m=>m);
  state.list = shuffle(items);
  state.idx = 0; state.seconds = 0; state.missedOnly = true; state.misses = [];
  startTimer();
  document.getElementById('result').classList.add('hidden');
  document.getElementById('quiz').classList.remove('hidden');
  document.getElementById('setTag').textContent = SET_LABELS[state.setKey] + ' — Missed Only';
  document.getElementById('best').textContent = 'Best: ' + getBest(bestKey());
  renderQ();
}

// nav
document.getElementById('begin').addEventListener('click', startRound);
document.getElementById('retry').addEventListener('click', startRound);
document.getElementById('retryMissed').addEventListener('click', startRoundMissed);
document.getElementById('restart').addEventListener('click', ()=>{
  document.getElementById('result').classList.add('hidden');
  document.getElementById('start').classList.remove('hidden');
});
</script>
</body>
</html>
